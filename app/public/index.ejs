<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <title>Dashboard</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!----css3---->
    <link rel="stylesheet" href="css/custom.css" />
    <!-- SLIDER REVOLUTION 4.x CSS SETTINGS -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
        rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.9.0/sweetalert2.min.js"
        integrity="sha512-GAaXlfJeIbLNG2LQu2v4pf8YEc7iPz+GE3LZyUmdR7d7Id5JsER9vmJVxMKw1MqmdlVh3NXxTxQVd9AS53G+4w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.9.0/sweetalert2.min.css"
        integrity="sha512-IScV5kvJo+TIPbxENerxZcEpu9VrLUGh1qYWv6Z9aylhxWE4k4Fch3CHl0IYYmN+jrnWQBPlpoTVoWfSMakoKA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />


    <!--google material icon-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />

    <style>
        .pagination {
            display: inline-block;
            justify-content: right;
        }

        .pagination a {
            color: black;
            float: left;
            padding: 8px 16px;
            text-decoration: none;
            transition: background-color .3s;
            border: 1px solid #ddd;
        }

        .pagination a.active {
            background-color: #4CAF50;
            color: white;
            border: 1px solid #4CAF50;
        }

        .pagination a:hover:not(.active) {
            background-color: #ddd;
        }


        .email_all {
            text-align: left;
        }

        .email_all .top {
            display: flex;
            align-items: center;
        }

        .email_all i {
            margin-right: 5px;
        }

        .email_content {
            background-color: rgb(217, 227, 231);
            padding: 5px;
        }

        .email_content p {
            padding: 0;
            margin: 0;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="body-overlay"></div>

        <!-- Sidebar  -->
        <%- include('componets/navbar.ejs'); %>
            <!-- Page Content  -->
                <div id="content">
                    <div class="top-navbar">
                        <%- include('componets/header.ejs'); %>
                    </div>
                    <div class="main-content">
                        <div class="row">
                            <div class="col-lg-3 col-md-6 col-sm-6">
                                <div class="card card-stats">
                                    <div class="card-header">
                                        <div class="icon icon-warning">
                                            <span class="material-icons">equalizer</span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <p class="category"><strong>No of Emails</strong></p>
                                        <h3 class="card-title" id="no_of_emails">0</h3>
                                    </div>
                                    <div class="card-footer">
                                        <div class="stats">
                                            <i class="material-icons text-info">info</i>
                                            <a href="#pablo">Total No of email send</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-6">
                                <div class="card card-stats">
                                    <div class="card-header">
                                        <div class="icon icon-rose">
                                            <span class="material-icons">shopping_cart</span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <p class="category"><strong>Open Email</strong></p>
                                        <h3 class="card-title" id="no_of_opened">0</h3>
                                    </div>
                                    <div class="card-footer">
                                        <div class="stats">
                                            <i class="material-icons">local_offer</i> Email Opened
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-6">
                                <div class="card card-stats">
                                    <div class="card-header">
                                        <div class="icon icon-success">
                                            <span class="material-icons"> attach_money </span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <p class="category"><strong>New Email</strong></p>
                                        <h3 class="card-title" id="no_of_new">0</h3>
                                    </div>
                                    <div class="card-footer">
                                        <div class="stats">
                                            <i class="material-icons">date_range</i> New mail Sended
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 col-sm-6">
                                <div class="card card-stats">
                                    <div class="card-header">
                                        <div class="icon icon-info">
                                            <span class="material-icons"> follow_the_signs </span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <p class="category"><strong>Falis Emails</strong></p>
                                        <h3 class="card-title" id="no_of_failed">0</h3>
                                    </div>
                                    <div class="card-footer">
                                        <div class="stats">
                                            <i class="material-icons">update</i> Just Updated
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-7 col-md-12">
                                <div class="card" style="min-height: 485px">
                                    <div class="card-header card-header-text">
                                        <h4 class="card-title">Employees Stats</h4>
                                        <p class="category">New employees on 15th December, 2016</p>
                                        <div>
                                            <select>
                                                <option>All</option>
                                                <option>New</option>
                                                <option>Opened</option>
                                                <option>Failed</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="card-content table-responsive">
                                        <table class="table table-hover">
                                            <thead class="text-primary">
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Email To.</th>
                                                    <th>Status</th>
                                                    <th>Details</th>
                                                </tr>
                                            </thead>
                                            <tbody id="email_table">
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="card-footer">
                                        <div class="pagination">
                                            <a href="#">&laquo;</a>
                                            <a href="#" class="active">1</a>
                                            <a href="#">2</a>
                                            <a href="#">3</a>
                                            <a href="#">4</a>
                                            <a href="#">5</a>
                                            <a href="#">6</a>
                                            <a href="#">&raquo;</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-5 col-md-12">
                                <div class="card" style="min-height: 485px">
                                    <div class="card-header card-header-text">
                                        <h4 class="card-title">Activities</h4>
                                    </div>
                                    <div class="card-content">
                                        <div class="streamline">
                                            <div class="sl-item sl-primary">
                                                <div class="sl-content">
                                                    <small class="text-muted">5 mins ago</small>
                                                    <p>Williams has just joined Project X</p>
                                                </div>
                                            </div>
                                            <div class="sl-item sl-danger">
                                                <div class="sl-content">
                                                    <small class="text-muted">25 mins ago</small>
                                                    <p>
                                                        Jane has sent a request for access to the project
                                                        folder
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="sl-item sl-success">
                                                <div class="sl-content">
                                                    <small class="text-muted">40 mins ago</small>
                                                    <p>Kate added you to her team</p>
                                                </div>
                                            </div>
                                            <div class="sl-item">
                                                <div class="sl-content">
                                                    <small class="text-muted">45 minutes ago</small>
                                                    <p>John has finished his task</p>
                                                </div>
                                            </div>
                                            <div class="sl-item sl-warning">
                                                <div class="sl-content">
                                                    <small class="text-muted">55 mins ago</small>
                                                    <p>Jim shared a folder with you</p>
                                                </div>
                                            </div>
                                            <div class="sl-item">
                                                <div class="sl-content">
                                                    <small class="text-muted">60 minutes ago</small>
                                                    <p>John has finished his task</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <footer class="footer">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-6">
                                        <nav class="d-flex">
                                            <ul class="m-0 p-0">
                                                <li>
                                                    <a href="#"> Home </a>
                                                </li>
                                                <li>
                                                    <a href="#"> Company </a>
                                                </li>
                                                <li>
                                                    <a href="#"> Portfolio </a>
                                                </li>
                                                <li>
                                                    <a href="#"> Blog </a>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="copyright d-flex justify-content-end">
                                            &copy 2023 Design by
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </footer>
                    </div>
                </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#sidebarCollapse").on("click", function () {
                $("#sidebar").toggleClass("active");
                $("#content").toggleClass("active");
            });

            $(".more-button,.body-overlay").on("click", function () {
                $("#sidebar,.body-overlay").toggleClass("show-nav");
            });

            setEmailTable();
        });

        const setEmailTable = () => {
            fetch('/email/get_email', {
                method: 'POST',
                body: JSON.stringify({
                    title: 'foo',
                    body: 'bar',
                    userId: 1
                }),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            }).then(
                res => {
                    res.json().then(
                        ({ email: data, stats_data: stats_data = {} }) => {
                            if (data.length > 0) {
                                var temp = '';
                                data.forEach((itemData, index) => {
                                    temp += `<tr>
                                    <td> ${index} </td>
                                    <td> ${itemData.to} </td>
                                    <td> ${itemData.status} </td>
                                    <td> 
                                        <div 
                                        class="btn btn-primary"
                                        onclick="showDetailsEmail('${itemData.html}', '${itemData.to}', '${itemData.status}')"
                                        >Details</div>
                                    </td>
                                    </tr>`;
                                });
                                document.getElementById('email_table').innerHTML = temp;
                            }
                            document.getElementById('no_of_emails').innerHTML = `<div>${stats_data.no_of_emails || 0}</div>`;
                            document.getElementById('no_of_new').innerHTML = `<div>${stats_data.no_of_new || 0}</div>`;
                            document.getElementById('no_of_opened').innerHTML = `<div>${stats_data.no_of_opened || 0}</div>`;
                            document.getElementById('no_of_failed').innerHTML = `<div>${stats_data.no_of_failed || 0}</div>`;
                        }
                    );
                }
            );
        };

        function showDetailsEmail(email_data, to, status) {
            console.log(email_data);
            Swal.fire({
                title: 'Email Content',
                text: 'Modal with a custom image.',
                html: `<div class="email_all"><div class="top"><i class="material-icons">email</i> ${to}</div>
                <div class="top"><i class="material-icons">label</i> ${status}</div>
                <div class="email_content">${email_data}</div></div>`,
                // imageUrl: 'https://unsplash.it/400/200',
                imageWidth: 400,
                imageHeight: 200,
                imageAlt: 'Custom image'
            });
        }
    </script>
</body>

</html>